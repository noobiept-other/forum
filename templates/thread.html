{% extends "base.html" %}
{% load humanize %}
{% load emotes %}

{% block content %}
{% if thread %}

<p>
{% for pageNumber in pages %}
    <a href="{% url 'thread' threadSlug pageNumber %}" class="PageLink">
        {% if pageNumber == page %}
            <em>{{ pageNumber }}</em>
        {% else %}
            {{ pageNumber }}
        {% endif %}
    </a>
{% endfor %}
</p>


<table id="ThreadTable">
    <tr id="post_0" class="ThreadRow">
        <td class="ThreadLeft">
            <a href="{{ thread.user.get_url }}">{{ thread.user }}</a> {{ thread.date_created|naturaltime }}<br />
            {{ thread.user.get_post_count }} posts<br />
            {% if thread.user.is_moderator %}
                moderator
            {% endif %}
        </td>
        <td class="ThreadRight">
            {{ thread.text|striptags|add_emotes|safe|linebreaksbr }}

            <ul class="postMenu">
                {% if thread.was_edited %}
                    <li>edited by <a href="{{ thread.edited_by.get_url }}">{{ thread.edited_by }}</a>: {{ thread.date_edited|naturaltime }}</li>
                {% endif %}

                {% if user == thread.user or user.is_moderator %}
                    <li><a href="{% url 'edit_thread' thread.slug %}">edit</a></li>
                {% endif %}
                {% if user.is_moderator %}
                    <li><a href="{% url 'lock_thread' thread.slug %}">
                        {% if thread.is_locked %}
                            unlock
                        {% else %}
                            lock
                        {% endif %}
                    </a></li>
                    <li><a href="{% url 'remove_thread_confirm' thread.slug %}">remove</a></li>
                {% endif %}
            </ul>
         </td>
    </tr>


{% if posts %}
    {% for post in posts %}
    <tr id="post_{{ forloop.counter }}" class="PostRow">
        <td class="ThreadLeft">
            <a href="{{ post.user.get_url }}">{{ post.user }}</a> {{ post.date_created|naturaltime }}<br />
            {{ post.user.get_post_count }} posts<br />
            {% if post.user.is_moderator %}
                moderator
            {% endif %}
        </td>
        <td class="ThreadRight">
            {{ post.text|striptags|add_emotes|safe|linebreaksbr }}

            <ul class="postMenu">
                {% if post.was_edited %}
                    <li>edited by <a href="{{ post.edited_by.get_url }}">{{ post.edited_by }}</a>: {{ post.date_edited|naturaltime }}</li>
                {% endif %}

                {% if user == post.user or user.is_moderator %}
                    <li><a href="{% url 'edit_post' post.id %}">edit</a></li>
                {% endif %}
                {% if user.is_moderator %}
                    <li><a href="{% url 'remove_post_confirm' post.id %}">remove</a></li>
                {% endif %}
            </ul>
        </td>
    </tr>
    {% endfor %}
{% endif %}
</table>

<p>
{% for pageNumber in pages %}
    <a href="{% url 'thread' threadSlug pageNumber %}" class="PageLink">
        {% if pageNumber == page %}
            <em>{{ pageNumber }}</em>
        {% else %}
            {{ pageNumber }}
        {% endif %}
    </a>
{% endfor %}
</p>

{% if thread.is_locked %}
    <p>Thread is locked.</p>
{% else %}
    {% if user.is_authenticated %}
        {% if form.errors %}
            <p>{{ form.errors }}</p>
        {% endif %}
        <form id="ThreadPostForm" method="post" action="{% url 'thread' threadSlug page %}">
            {% csrf_token %}

            {{ form.text }}

            <input type="submit" value="post" />
            <input type="hidden" name="next" value="{{ next }}" />
        </form>
    {% else %}
        <p>Need to login to post.</p>
    {% endif %}
{% endif %}

{% else %}
    <p>No thread.</p>
{% endif %}
{% endblock %}